{% extends "base.html" %}

{% block header_content %}
<section id="gift-box-masthead" class="squatch-masthead -shadow" style="background-image: url('{{'images/squatch-masthead-bg-green.jpg' | asset_url }}')">
  <div class="gift-box-masthead-inner _container _grid-2">
    <div class="squatch-masthead-image"><img src="{{'images/gift-box.png' | asset_url }}" alt="Gift Box" /></div>
    <div class="squatch-masthead-content">
      <h1>Gift Box</h1>
      <div class="price-slash-wrapper">
          <h5 class="price-slashed"><span>$</span>53</h5>
          <h5 class="price-savings"><span>$</span>39</h5>
      </div>
      <h3>A Unique Gift with a Personal Touch</h3>
      <a href="#choose-your-scents"><button>Choose Your Scents</button></a>
    </div>
  </div>
</section>
{% endblock %}

{% block page_content %}

<section class="gift-box-page-content">
  <ul class="gift-box-perks">
    <li><span class="gift-box-perks-image"><img src="{{'images/icon-mailbox.png' | asset_url }}" alt="Mailbox Icon" /></span> <span class="gift-box-perks-text">Custom Cigar Box</span></li>
    <li><span class="gift-box-perks-image"><img src="{{'images/icon-mustache.png' | asset_url }}" alt="Mustache Icon" /></span> <span class="gift-box-perks-text">Pick the Bars That Fit Your Guy</span></li>
    <li><span class="gift-box-perks-image"><img src="{{'images/icon-stars.png' | asset_url }}" alt="Stars Icon" /></span> <span class="gift-box-perks-text">Make It Special With Extras</span></li>
  </ul>
  <h2>Great Gifts, Made Easy</h2>
  <p>Finding the perfect gift for a dude is no easy task; look no further than the stack of never-worn clown ties in your dadâ€™s closet. Take the guesswork out of gentleman gifting when you ship a custom cigar box of all-natural goodness.</p>
</section>
<h3 id="choose-your-scents" class="gift-box-step"><span>1.</span> Pick Your Bundle</h3>
<section class="gift-box-select _grid-3">
  {% set product = 81318210 | get_product %}
  <div class="gift-box-select-single" style="background-image: url('{{'images/gift-box-woods-background.jpg' | asset_url }}')">
    <h2>The <em>Best s(M)ellers</em> Box</h2>
    <img src="{{'images/gift-box-best-smellers.png' | asset_url }}" alt="Gift Box" />
    <fieldset class="squatch-gift-box-option" data-product-id="{{ product.id }}" data-price="39">
      {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
      <input type="radio" id="radio-gift-box-best-smellers" name="gift-box-primary">
      <label for="radio-gift-box-best-smellers"><i class="fa fa-square-o"></i> Select</label>
      {% else %}
      <label for="radio-gift-box-best-smellers"><i class="fa fa-times"></i> OUT OF STOCK</label>
      {% endif %}
    </fieldset>
  </div>
  {% set product = 81325435 | get_product %}
  <div class="gift-box-select-single" style="background-image: url('{{'images/gift-box-wood-background.jpg' | asset_url }}')">
      <h2>The <em>Woodsman</em> box</h2>
      <img src="{{'images/gift-box-woodsman-box.png' | asset_url }}" alt="Gift Box" />
      <fieldset class="squatch-gift-box-option" data-product-id="81325435" data-price="39">
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <input type="radio" id="radio-gift-box-woodsman" name="gift-box-primary">
        <label for="radio-gift-box-woodsman"><i class="fa fa-square-o"></i> Select</label>
        {% else %}
        <label for="radio-gift-box-woodsman"><i class="fa fa-times"></i> OUT OF STOCK</label>
        {% endif %}
      </fieldset>
  </div>
  {% set product = 81326129 | get_product %}
  <div class="gift-box-select-single" style="background-image: url('{{'images/gift-box-orange-soap-background.jpg' | asset_url }}')">
    <h2>The <em>Super Fresh</em> box</h2>
    <img src="{{'images/gift-box-super-fresh-box.png' | asset_url }}" alt="Gift Box" />
    <fieldset class="squatch-gift-box-option" data-product-id="81326129" data-price="39">
      {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
      <input type="radio" id="radio-gift-box-super-fresh" name="gift-box-primary">
      <label for="radio-gift-box-super-fresh"><i class="fa fa-square-o"></i> Select</label>
      {% else %}
      <label for="radio-gift-box-super-fresh"><i class="fa fa-times"></i> OUT OF STOCK</label>
      {% endif %}
    </fieldset>
  </div>
</section>
<section class="gift-box-step-two-section">
  <h3 class="gift-box-step"><span>2.</span> Make It Extra Special</h3>
  <div class="squatch-horizontal-slider" data-transform="0">
    <div class="squatch-horizontal-slider-inner">
      <div class="squatch-horizontal-slide">
        {% set product = 70698419 | get_product %}
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <div>
          <img src="{{'images/squatch-soap-saver.png' | asset_url }}" alt="Soap Saver" />
          <h4>Soap Saver</h4>
          <p class="squatch-price"><span>$</span>15</p>
          <fieldset class="squatch-gift-box-option" data-product-id="70698419" data-price="15">
            <input type="checkbox" id="squatch-soap-saver">
            <label for="squatch-soap-saver"><i class="fa fa-square-o"></i> Select</label>
          </fieldset>
        </div>
        {% endif %}

        {% set product = 1727791130 | get_product %}
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <div>
          <img src="{{'images/lakeside-bourbon.png' | asset_url }}" alt="Lakeside Bourbon" />
          <h4>Lakeside Bourbon</h4>
          <p class="squatch-price"><span>$</span>18</p>
          <fieldset class="squatch-gift-box-option" data-product-id="1727791130" data-price="18">
            <input type="checkbox" id="squatch-lakeside-bourbon">
            <label for="squatch-lakeside-bourbon"><i class="fa fa-square-o"></i> Select</label>
          </fieldset>
        </div>
        {% endif %}

        {% set product = 70704519 | get_product %}
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <div>
          <img src="{{'images/crushed-pine.png' | asset_url }}" alt="Soap Saver" />
          <h4>Crushed Pine Cologne</h4>
          <p class="squatch-price"><span>$</span>21</p>
          <fieldset class="squatch-gift-box-option" data-product-id="70704519" data-price="21">
            <input type="checkbox" id="squatch-crushed-pine-cologne">
            <label for="squatch-crushed-pine-cologne"><i class="fa fa-square-o"></i> Select</label>
          </fieldset>
        </div>
        {% endif %}

        {% set product = 70704176 | get_product %}
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <div>
          <img src="{{'images/Cologne_Beechwood_Bourbonpng.png' | asset_url }}" alt="Hair Care" />
          <h4>Beechwood Bourbon Cologne</h4>
          <p class="squatch-price"><span>$</span>21</p>
          <fieldset class="squatch-gift-box-option" data-product-id="70704176" data-price="21">
            <input type="checkbox" id="squatch-beechwood-bourbon-cologne">
            <label for="squatch-beechwood-bourbon-cologne"><i class="fa fa-square-o"></i> Select</label>
          </fieldset>
        </div>
        {% endif %}

        {% set product = 1727801243 | get_product %}
        {% if product.instances[0].inventory.quantity_on_hand > 0 or product.instances[0].inventory.out_of_stock_purchases==True %}
        <div>
          <img src="{{'images/fresh-fir.png' | asset_url }}" alt="Fresh Fir" />
          <h4>Fresh Fir</h4>
          <p class="squatch-price"><span>$</span>18</p>
          <fieldset class="squatch-gift-box-option" data-product-id="1727801243" data-price="18">
            <input type="checkbox" id="squatch-fresh-fir">
            <label for="squatch-fresh-fir"><i class="fa fa-square-o"></i> Select</label>
          </fieldset>
        </div>
        {% endif %}
        
      </div>
    </div>
    <div class="squatch-horizontal-slide-controls">
      <div class="squatch-horizontal-slide-control" data-direction="prev">
        <i class="fa fa-angle-left"></i>
      </div>
      <div class="squatch-horizontal-slide-control" data-direction="next">
        <i class="fa fa-angle-right"></i>
      </div>
    </div>
  </div>
</section>
<section class="squatch-grand-total">
  <p>Total With<br>Selected Options</p>
  <p class="squatch-price"><span>$</span>0</p>
  <button>Add To Cart</button>
</section>
<!-- Yotpo Review -->
<section class="pholder bg-alt new_review_section">
  <div class="pholder-header">
    <div id="product-reviews-list-row" class="pholder-header">
    	<h1 class="heading hlight">REVIEWS</h1>
        <div class="yotpo yotpo-main-widget"
             data-product-id="81318210"
             data-name="Best Sellers Gift Box"
             data-url="https://drsquatch.com/giftbox"
             data-image-url="The product image url. Url escaped"
             data-description="Gold Moss, Pine Tar, Spearmint Basil, Bay Rum">
        </div>
    </div>
  </div>
</section>
<!-- end -->
{% endblock %}

{% block page_javascript %}
<script src="{{'js/jquery.formstyler.min.js' | asset_url}}"></script>
<script type="text/javascript">

document.body.classList.add('page-gift-box');

function giftbox_prepare() {
  document.querySelectorAll('.gift-box-select-single label').forEach(elem => {
    elem.addEventListener('click', e => {
      document.querySelectorAll('.gift-box-select-single').forEach(select => {
        select.classList.add('-not-selected');
      });
      e.target.closest('.gift-box-select-single').classList.remove('-not-selected');
    })
  });

  document.querySelectorAll('.squatch-gift-box-option label').forEach(elem => {
    elem.addEventListener('click', e => {
      setTimeout(update_grand_total, 100);
    });
  });

  document.querySelector('.squatch-grand-total button').addEventListener('click', e => {
    let final_items = update_grand_total();
    squatch_add_to_cart(final_items);
  });
}

function update_grand_total() {
  let elem = document.querySelector('.squatch-grand-total .squatch-price'),
      cart_items = [],
      grand_total = 0;


  document.querySelectorAll('.squatch-gift-box-option').forEach(elem => {
    if (elem.querySelector('input').checked) {
      let item = {
        id: elem.getAttribute('data-product-id'),
        price: parseInt(elem.getAttribute('data-price'))
      };
      
      cart_items.push(item);
      grand_total += item.price;
    }
  });

  elem.innerHTML = `<span>$</span>${grand_total}`;
  return cart_items;
}

function squatch_add_callback() {
  jQuerySafe("#cart-slide").modal('show');
}

function squatch_add_to_cart(items = []) {
    let cart_data = {}, 
        single_data = [];

    items.forEach(item => {
      let single_item = {
        product_id: item.id,
        qty: 1
      }
      BBSafe.trigger("newProduct:add", item.id, squatch_add_callback);
      single_data.push(single_item);
    });

    cart_data['products'] = single_data;
    console.log(cart_data);

    $.ajax({
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(cart_data),
      dataType: 'json',
      url: '/cart/add',
      success: function(e){

      }
    });
}

function prepare_anchor_links() {
    document.querySelectorAll('a[href^="#"]').forEach(elem => {
        elem.addEventListener('click', e => {
            e.preventDefault();

            let target = elem.getAttribute('href'),
                target_top = document.querySelector(target).offsetTop,
                padding = document.querySelector('.navbar').clientHeight,
                top = target_top - padding;

            window.scroll({
                top: top,
                left: 0, 
                behavior: 'smooth' 
            });          
        });
    });
}

giftbox_prepare();
prepare_anchor_links();

</script>
<script src="{{ 'js/raindrop.min.js' | asset_url }}"></script>
{% endblock %}
